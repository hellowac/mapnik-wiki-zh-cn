<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="Development" href="Development.html" /><link rel="prev" title="Plugin Architecture" href="PluginArchitecture.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Mapnik2 - mapnik-wiki-zh-cn 1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">mapnik-wiki-zh-cn 1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">mapnik-wiki-zh-cn 1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Introductory Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About-Mapnik.html">About Mapnik</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mapnik-Installation.html">Mapnik Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="LearningMapnik.html">Learning Mapnik</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notes-and-caveats.html">Notes and caveats</a></li>
<li class="toctree-l1"><a class="reference internal" href="Related-projects-and-utilities.html">Related projects and utilties</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mapnik API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="XMLConfigReference.html">Mapnik configuration XML</a></li>
<li class="toctree-l1"><a class="reference internal" href="SymbologySupport.html">Symbology Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="PluginArchitecture.html">Plugin Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://github.com/mapnik/mapnik/blob/master/INSTALL.md">Building Mapnik</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Mapnik2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="MapnikReleases.html">Mapnik Releases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/#!forum/mapnik">Mailing List</a></li>
<li class="toctree-l1"><a class="reference external" href="http://webchat.freenode.net/?channels=#mapnik">#mapnik channel on irc.freenode.net Webchat</a></li>
<li class="toctree-l1"><a class="reference internal" href="Code-sprint.html">Code sprint</a></li>
<li class="toctree-l1"><a class="reference external" href="http://173.255.217.246:8000/mapnik_trac/wiki/MapnikCodeSprint/MCS01">Code sprint 2010 - Committers and Cartographers London, England, 24-26 September 2010</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/Mapnik2.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="mapnik2">
<h1>Mapnik2<a class="headerlink" href="#mapnik2" title="Link to this heading">¶</a></h1>
<p>Mapnik2 is the name for the Mapnik (2.0.0) and 2.x series. In this major release we jumped from 0.7.x to 2.x.</p>
<p>To get Mapnik 2.x either:</p>
<ol class="arabic simple">
<li><p>Download the latest master from github <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/mapnik/mapnik.git</span></code></p></li>
<li><p>Download the latest 2.x series release from <a class="reference external" href="https://github.com/mapnik/mapnik/downloads">https://github.com/mapnik/mapnik/downloads</a>.</p></li>
<li><p>Or, read about installing for specific platforms: <a class="reference external" href="https://github.com/mapnik/mapnik/wiki/Mapnik-Installation">https://github.com/mapnik/mapnik/wiki/Mapnik-Installation</a></p></li>
</ol>
<p>Mapnik2 was over a year in development before formal release for two reasons:</p>
<ul class="simple">
<li><p>Mapnik2 requires at least Boost 1.42, and we waited for major linux distributions to start packaging at least that boost version</p></li>
<li><p>Mapnik2 simplifies a few elements of the XML syntax in backward incompatible ways.</p></li>
</ul>
<section id="naming-conventions">
<h2>Naming conventions<a class="headerlink" href="#naming-conventions" title="Link to this heading">¶</a></h2>
<p>While Mapnik2 was in development (and for the 2.0.0 release) we implemented a naming change for ease of development and testing.</p>
<p>But this is now rolled back, following the first release of 2.0.0. So the basics are:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><em>version</em></p></th>
<th class="head"><p><em>library</em></p></th>
<th class="head"><p><em>python module</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.7.x</p></td>
<td><p>libmapnik</p></td>
<td><p>mapnik</p></td>
</tr>
<tr class="row-odd"><td><p>2.0.0</p></td>
<td><p>libmapnik2</p></td>
<td><p>mapnik2</p></td>
</tr>
<tr class="row-even"><td><p>&gt;= 2.1 (current master)</p></td>
<td><p>libmapnik</p></td>
<td><p>mapnik (mapnik2 works but issues warning)</p></td>
</tr>
</tbody>
</table>
</div>
<p>To get the library name for your install of Mapnik2 do:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mapnik-config --libs
-L/usr/local/lib -lmapnik
</pre></div>
</div>
<p>Specifically in python with Mapnik 2.0.0 and 2.1 you can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik2</span> <span class="c1"># . This made it easier for developers to run the Mapnik 0.7.x series alongside Mapnik2.</span>
</pre></div>
</div>
<p>But, the current development code (and the upcoming Mapnik 2.1.0 release) has now moved back to using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span> <span class="c1">#import mapnik2 will still work but will issue a deprecation warning</span>
</pre></div>
</div>
</section>
<section id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Link to this heading">¶</a></h2>
<p>The Mapnik2 API has advanced (requiring breakages) and the XML syntax has changed in specific cases.</p>
<p>Therefore Mapnik2 is the <a class="reference internal" href="MapnikReleases.html"><span class="doc std std-doc">first release</span></a> with significant backward incompatibility. See <a class="reference internal" href="Mapnik2_Changes.html"><span class="doc std std-doc">Mapnik2_Changes</span></a></p>
</section>
<section id="upgrade-guide">
<h2>Upgrade Guide<a class="headerlink" href="#upgrade-guide" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Recommended: rebuild shapefile indexes</p></li>
</ol>
<p>Say you have a directory of shapefiles in a folder named 'shapes'. Then you can regenerate all the indexes at once like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>shapeindex<span class="w"> </span>shapes/*.shp
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Required: upgrade stylesheets</p></li>
</ol>
<p>We have written a python converter to automatically upgrade your pre-Mapnik2 stylesheets to be fully compatible with Mapnik2.</p>
<p>After installing Mapnik2 you will have a new command available called 'upgrade_map_xml.py':</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">upgrade_map_xml</span><span class="o">.</span><span class="n">py</span>
    <span class="n">Usage</span><span class="p">:</span> <span class="n">upgrade_map_xml</span><span class="o">.</span><span class="n">py</span> <span class="o">&lt;</span><span class="n">input_file</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">output_file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For osm.xml users, you will note that this script does not preserve entities. The best approach (until osm.xml is upgraded to require at least mapnik 2.x) is to continue editing the osm.xml and just convert it each time you wish to render with Mapnik2.</p>
<p>Also, we have ported support for the new Mapnik2 syntax to the 0.7.2 release, so with 0.7.2 you can stay on the stable 0.7 series but keep your stylesheets in the cleaner Mapnik2 format.</p>
<section id="cascadenik">
<h3>Cascadenik<a class="headerlink" href="#cascadenik" title="Link to this heading">¶</a></h3>
<p>There is a branch of Cascadenik that is adding Mapnik2 compatibility at <a class="reference external" href="https://github.com/mapnik/Cascadenik/tree/mapnik2">https://github.com/mapnik/Cascadenik/tree/mapnik2</a></p>
</section>
<section id="nik2img">
<h3>nik2img<a class="headerlink" href="#nik2img" title="Link to this heading">¶</a></h3>
<p>Nik2img as of 0.5.0 supports both mapnik and mapnik2 transparently. Pass --mapnik-version 1 or mapnik-version 2 to force the usage of a single one (it will default to using Mapnik2)</p>
</section>
<section id="mod-tile-renderd">
<h3>mod_tile/renderd<a class="headerlink" href="#mod-tile-renderd" title="Link to this heading">¶</a></h3>
<p>Supports Mapnik2 as of <a class="reference external" href="http://trac.openstreetmap.org/changeset/22900">r22900</a>.</p>
<p>Please note, as per the above naming changes, if using Mapnik 2.0.0 the library name is <code class="docutils literal notranslate"><span class="pre">libmapnik2</span></code>, but all previous and future releases simply use <code class="docutils literal notranslate"><span class="pre">libmapnik</span></code> as the library name. Sorry for the temporarily hassle.</p>
<p>So, if you are using exactly the 2.0.0 release, here is the basic patch needed to the Makefile:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>   Index: Makefile
<span class="w"> </span>   ===================================================================
<span class="w"> </span>   --- Makefile (revision 22899)
<span class="w"> </span>   +++ Makefile (working copy)
<span class="w"> </span>   @@ -51,7 +51,7 @@
<span class="w"> </span>    RENDER_LDFLAGS += -L/usr/local/lib
<span class="w"> </span>    endif
<span class="w"> </span>    
<span class="w"> </span>   -RENDER_LDFLAGS += -lmapnik -Liniparser3.0b -liniparser
<span class="w"> </span>   +RENDER_LDFLAGS += -lmapnik2 -Liniparser3.0b -liniparser
<span class="w"> </span>    
<span class="w"> </span>    ifeq ($(UNAME), Darwin)
<span class="w"> </span>    RENDER_LDFLAGS += -licuuc -lboost_regex
</pre></div>
</div>
<p>Because Mapnik2 headers are not renamed (they are still 'include/mapnik'_ it is not possible to simultaneously compile C++ applications against headers of both Mapnik2 and Mapnik 0.7.x.</p>
<p>However, Python applications should be able to work against either Mapnik or Mapnik2 if both are installed.</p>
</section>
</section>
<section id="changes">
<h2>Changes<a class="headerlink" href="#changes" title="Link to this heading">¶</a></h2>
<p>see <a class="reference internal" href="Mapnik2_Changes.html"><span class="doc std std-doc">Mapnik2_Changes</span></a></p>
</section>
<section id="building-icu">
<h2>Building ICU<a class="headerlink" href="#building-icu" title="Link to this heading">¶</a></h2>
<p>Mapnik2 requires at least icu &gt;= 4.2.</p>
<ol class="arabic simple">
<li><p>Get the latest release:</p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>wget<span class="w"> </span>http://download.icu-project.org/files/icu4c/4.6/icu4c-4_6-src.tgz
<span class="w">    </span>tar<span class="w"> </span>xzvf<span class="w"> </span>icu4c-4_6-src.tgz
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>icu/source
<span class="w">    </span>./runConfigureICU<span class="w"> </span>Linux<span class="w"> </span><span class="c1"># on os x do: ./runConfigureICU MacOSX</span>
<span class="w">    </span>make
<span class="w">    </span>sudo<span class="w"> </span>make<span class="w"> </span>install
<span class="w">    </span>sudo<span class="w"> </span>ldconfig
</pre></div>
</div>
</section>
<section id="building-boost">
<h2>Building Boost<a class="headerlink" href="#building-boost" title="Link to this heading">¶</a></h2>
<p>You need boost &gt;=1.41 for Mapnik2 (ideally 1.42).</p>
<p>Grab some dependencies (this is for debian systems)</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libbz2-dev
</pre></div>
</div>
<p>If you are compiling on Mac OS X see: <a class="reference external" href="http://github.com/mapnik/mapnik/wiki/MacInstallation#Step1:RouteBC">http://github.com/mapnik/mapnik/wiki/MacInstallation#Step1:RouteBC</a></p>
<p>Otherwise on linux do:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>wget<span class="w"> </span>http://voxel.dl.sourceforge.net/project/boost/boost/1.51.0/boost_1_51_0.tar.bz2
<span class="w">    </span>tar<span class="w"> </span>xjvf<span class="w"> </span>boost_1_51_0.tar.bz2
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>boost_1_51_0
<span class="w">    </span>./bootstrap.sh
<span class="w">    </span>./b2<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-thread<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-filesystem<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-iostreams<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-python<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-regex<span class="w"> </span>-sHAVE_ICU<span class="o">=</span><span class="m">1</span><span class="w"> </span>-sICU_PATH<span class="o">=</span>/usr/local<span class="w">  </span><span class="se">\</span>
<span class="w">      </span>--with-program_options<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-system<span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">link</span><span class="o">=</span>shared<span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">toolset</span><span class="o">=</span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>stage
<span class="w">    </span>sudo<span class="w"> </span>./b2<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-thread<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-filesystem<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-iostreams<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-python<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-regex<span class="w"> </span>-sHAVE_ICU<span class="o">=</span><span class="m">1</span><span class="w"> </span>-sICU_PATH<span class="o">=</span>/usr/local<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-program_options<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>--with-system<span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">toolset</span><span class="o">=</span>gcc<span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">link</span><span class="o">=</span>shared<span class="w"> </span><span class="se">\</span>
<span class="w">      </span>install
<span class="w">    </span>sudo<span class="w"> </span>ldconfig
</pre></div>
</div>
<p>Note: see the custom builds of libboost_regex and libboost_python below (if using these then you can remove them from the above lines)</p>
<p><em>Note: Starting from r2760  there is no dependency on boost::iostreams library in shape.input and '--with-iostreams' flag can be omitted while building boost.</em></p>
<p>To rebuild just boost_regex, for example to compile/link in the right ICU support try:</p>
<ul class="simple">
<li><p>-a forces rebuild/install</p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>sudo<span class="w"> </span>./b2<span class="w">  </span>--with-regex<span class="w"> </span><span class="nv">toolset</span><span class="o">=</span>gcc<span class="w"> </span>-sHAVE_ICU<span class="o">=</span><span class="m">1</span><span class="w"> </span>-sICU_PATH<span class="o">=</span>/usr/local<span class="w"> </span>-a<span class="w"> </span>install
</pre></div>
</div>
<p>Note: If later when compiling mapnik you get and error like...</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="n">Checking</span> <span class="k">for</span> <span class="n">C</span><span class="o">++</span> <span class="n">library</span> <span class="n">boost_regex</span><span class="o">...</span> <span class="n">no</span>
     <span class="o">...</span>
</pre></div>
</div>
<p>it might be because you have two versions of libicu on your system. You have to recompile boost such that <code class="docutils literal notranslate"><span class="pre">ldd</span> <span class="pre">/usr/local/lib/libboost_regex.so</span></code> is the latest version. Since b2 tends to give some problem when passing parameters, one way to overcome this could be to move the libicu*.so.40 libraries for example and replace them with the ones compiled on /usr/local/lib/libicu* and then rebuild boost with regex support. You could later return them to the same place so that both <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">mapnik</span></code> and <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">mapnik2</span></code> work.</p>
<p>Note: you may want to (re)build boost_python against a specific version of python on your system. To do this in the most robust way (because passing command line args to b2 is hard), create a custom jam file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="kn">import</span><span class="w"> </span><span class="nn">option</span> <span class="p">;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">feature</span> <span class="p">;</span>
    <span class="k">if</span> <span class="err">!</span> <span class="n">gcc</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">feature</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;</span><span class="n">toolset</span><span class="o">&gt;</span> <span class="p">]</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="n">gcc</span> <span class="p">;</span> 
    <span class="p">}</span>
    <span class="n">project</span> <span class="p">:</span> <span class="n">default</span><span class="o">-</span><span class="n">build</span> <span class="o">&lt;</span><span class="n">toolset</span><span class="o">&gt;</span><span class="n">gcc</span> <span class="p">;</span>
    <span class="n">using</span> <span class="n">python</span>
         <span class="p">:</span> <span class="mf">2.5</span> <span class="c1"># version</span>
         <span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python2</span><span class="mf">.5</span> <span class="c1"># cmd-or-prefix</span>
         <span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">python2</span><span class="mf">.5</span><span class="o">/</span> <span class="c1"># includes</span>
         <span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="mf">.5</span><span class="o">/</span><span class="n">config</span><span class="o">/</span> <span class="c1"># directory holding libpython</span>
         <span class="p">:</span> <span class="o">&lt;</span><span class="n">toolset</span><span class="o">&gt;</span><span class="n">gcc</span> <span class="c1"># condition</span>
         <span class="p">;</span>
    <span class="n">libraries</span> <span class="o">=</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">python</span> <span class="p">;</span>
</pre></div>
</div>
<p>Then (re) compile the boost python lib using this custom jam file (call it 'user-config.jam'):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>bjam<span class="w"> </span>--with-python<span class="w"> </span>-a<span class="w"> </span>-j2<span class="w"> </span>--ignore-site-config<span class="w"> </span>--user-config<span class="o">=</span>user-config.jam<span class="w"> </span><span class="nv">toolset</span><span class="o">=</span>gcc<span class="w"> </span>stage<span class="w"> </span>-d2
<span class="w">    </span>sudo<span class="w"> </span>cp<span class="w"> </span>stage/lib/libboost_python.so*<span class="w"> </span>/path/to/install/dir/lib<span class="w"> </span><span class="c1"># modify for your system</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Development.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Development</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="PluginArchitecture.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Plugin Architecture</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, hellowac
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Mapnik2</a><ul>
<li><a class="reference internal" href="#naming-conventions">Naming conventions</a></li>
<li><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li><a class="reference internal" href="#upgrade-guide">Upgrade Guide</a><ul>
<li><a class="reference internal" href="#cascadenik">Cascadenik</a></li>
<li><a class="reference internal" href="#nik2img">nik2img</a></li>
<li><a class="reference internal" href="#mod-tile-renderd">mod_tile/renderd</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes">Changes</a></li>
<li><a class="reference internal" href="#building-icu">Building ICU</a></li>
<li><a class="reference internal" href="#building-boost">Building Boost</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=f115507d"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    </body>
</html>