<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>PostGIS - mapnik-wiki-zh-cn 1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">mapnik-wiki-zh-cn 1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">mapnik-wiki-zh-cn 1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Introductory Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="About-Mapnik.html">About Mapnik</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mapnik-Installation.html">Mapnik Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="LearningMapnik.html">Learning Mapnik</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notes-and-caveats.html">Notes and caveats</a></li>
<li class="toctree-l1"><a class="reference internal" href="Related-projects-and-utilities.html">Related projects and utilties</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mapnik API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="XMLConfigReference.html">Mapnik configuration XML</a></li>
<li class="toctree-l1"><a class="reference internal" href="SymbologySupport.html">Symbology Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="PluginArchitecture.html">Plugin Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/mapnik/mapnik/blob/master/INSTALL.md">Building Mapnik</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mapnik2.html">Mapnik2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="MapnikReleases.html">Mapnik Releases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/#!forum/mapnik">Mailing List</a></li>
<li class="toctree-l1"><a class="reference external" href="http://webchat.freenode.net/?channels=#mapnik">#mapnik channel on irc.freenode.net Webchat</a></li>
<li class="toctree-l1"><a class="reference internal" href="Code-sprint.html">Code sprint</a></li>
<li class="toctree-l1"><a class="reference external" href="http://173.255.217.246:8000/mapnik_trac/wiki/MapnikCodeSprint/MCS01">Code sprint 2010 - Committers and Cartographers London, England, 24-26 September 2010</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/PostGIS.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="postgis">
<h1>PostGIS<a class="headerlink" href="#postgis" title="Link to this heading">¶</a></h1>
<p>Mapnik's PluginArchitecture supports the use of different input formats.</p>
<p>This plugin supports <a class="reference external" href="http://en.wikipedia.org/wiki/PostGIS">PostGIS</a>, a spatial extension to the popular PostgreSQL database.</p>
<p>See also a performance tuning page: <a class="reference internal" href="OptimizeRenderingWithPostGIS.html"><span class="doc std std-doc">OptimizeRenderingWithPostGIS</span></a></p>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p><em>name = default value</em></p></th>
<th class="head text-left"><p><em>type</em></p></th>
<th class="head text-left"><p><em>description</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>host</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>name of the postgres host</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>port</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>name of the postgres port</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>dbname</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>name of the database</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>user</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>username to use for connecting</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>password</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>user password to use for connecting</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>application_name</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>connection <a class="reference external" href="https://www.postgresql.org/docs/current/runtime-config-logging.html#GUC-APPLICATION-NAME">application_name</a>. If omitted, then <a class="reference external" href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-FALLBACK-APPLICATION-NAME">fallback_application_name</a> = &quot;mapnik&quot; will be set instead. <br>Available in Mapnik &gt;= 4.0</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>table</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>name of the table to fetch, this can be a sub-query;  subquery has to use syntax of:  '( ) as subquery'.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>geometry_field</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>name of the geometry field, in case you have more than one in a single table. This field and the SRID will be deduced from the query in most cases, but may need to be manually specified in some cases.</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>geometry_table</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>name of the table containing the returned geometry; for determining RIDs with subselects</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>srid = 0</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>srid of the table, if this is &gt; 0 then fetching data will avoid an extra database query for knowing the srid of the table</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>extent</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>maxextent of the geometries; if omitted, the extent will be determined by querying the metadata for the table</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>extent_from_subquery = false</p></td>
<td class="text-left"><p>boolean</p></td>
<td class="text-left"><p>evaluate the extent of the subquery, this might be a performance issue</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>connect_timeout = 4</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>timeout is seconds for the connection to take place</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>persist_connection = true</p></td>
<td class="text-left"><p>boolean</p></td>
<td class="text-left"><p>choose whether to share the same connection for subsequent queries</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>row_limit = 0</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>max number of rows to return when querying data, 0 means no limit</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>cursor_size = 0</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>if this is &gt; 0 then server cursor will be used, and will prefetch this number of features</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>initial_size = 1</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>initial size of the stateless connection pool</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>max_size = 10</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>max size of the stateless connection pool</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>multiple_geometries = false</p></td>
<td class="text-left"><p>boolean</p></td>
<td class="text-left"><p>whether to use multiple different objects or a single one when dealing with multi-objects (this is mainly related to how the label are used in the map, one label for a multi-polygon or one label for each polygon of a multi-polygon)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>encoding = utf-8</p></td>
<td class="text-left"><p>string</p></td>
<td class="text-left"><p>internal file encoding</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>simplify_geometries = false</p></td>
<td class="text-left"><p>boolean</p></td>
<td class="text-left"><p>whether to automatically <a class="reference external" href="http://blog.cartodb.com/post/20163722809/speeding-up-tiles-rendering">reduce input vertices</a>. Only effective when output projection matches (or is similar to) input projection. Available from version 2.1.x up.</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>~~asynchronous_request~~</p></td>
<td class="text-left"><p>boolean</p></td>
<td class="text-left"><p>~~Postgres queries are sent asynchronously : while rendering a layer, queries for further layers will run in parallel in the remote server.  Available from version 2.3.x up.~~ <br><em>DEPRECATED</em> (automatically set internally based on <code class="docutils literal notranslate"><span class="pre">max_async_connection</span> <span class="pre">&gt;</span> <span class="pre">1</span></code> condition)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>max_async_connection = 1</p></td>
<td class="text-left"><p>integer</p></td>
<td class="text-left"><p>max number of PostGIS queries for rendering one map in asynchronous mode. Full doc <a class="reference internal" href="Postgis-async.html"><span class="doc std std-doc">here</span></a>. ~~Used only when asynchronous_request=true.~~ Default value (1) has no effect.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p><em>Note</em>:</p>
<ul class="simple">
<li><p>Spatial tables read from PostGIS by Mapnik should ideally have a corresponding entry in <code class="docutils literal notranslate"><span class="pre">geometry_columns</span></code>.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">geometry_field</span></code> parameter to specify which field to use if you have &gt;1 geometry in the table/query or if your table does not have a <code class="docutils literal notranslate"><span class="pre">geometry_columns</span></code> entry.</p></li>
</ul>
</section>
<section id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">¶</a></h2>
<p>The PostGIS plugin supports several special tokens. You can use them in subqueries and Mapnik will replace them at render time.</p>
<section id="bbox-token">
<h3>bbox token<a class="headerlink" href="#bbox-token" title="Link to this heading">¶</a></h3>
<p>Under normal circumstances, if you pass to Mapnik <code class="docutils literal notranslate"><span class="pre">table=mytable</span></code> then, when <code class="docutils literal notranslate"><span class="pre">mytable</span></code> is ultimately queried, Mapnik will form up a query like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ST_AsBinary</span><span class="p">(</span><span class="s2">&quot;geom&quot;</span><span class="p">)</span> <span class="n">AS</span> <span class="n">geom</span><span class="p">,</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;gid&quot;</span> <span class="n">FROM</span> <span class="n">mytable</span> <span class="n">WHERE</span> <span class="s2">&quot;geom&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">ST_SetSRID</span><span class="p">(</span><span class="s1">&#39;BOX3D(&lt;map bbox&gt;)&#39;</span><span class="p">::</span><span class="n">box3d</span><span class="p">,</span> <span class="mi">3857</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the token !bbox! allows you to write a subquery and leverage the spatial filter in a custom way. So, if you wished to override the <code class="docutils literal notranslate"><span class="pre">geom</span> <span class="pre">&amp;&amp;</span></code> and do <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> instead then you could do (in XML):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;table&quot;</span><span class="nt">&gt;</span>(Select<span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>mytable<span class="w"> </span>where<span class="w"> </span>ST_Intersects(geom,!bbox!))<span class="w"> </span>as<span class="w"> </span>mysubquery<span class="nt">&lt;/Parameter&gt;</span>
</pre></div>
</div>
</section>
<section id="other-tokens">
<h3>other tokens<a class="headerlink" href="#other-tokens" title="Link to this heading">¶</a></h3>
<p>Other tokens that can be used include:</p>
<ul class="simple">
<li><p>!scale_denominator! (Mapnik &gt;= 0.7.0)</p></li>
<li><p>!pixel_width! (Mapnik &gt;= 2.1.0) -- width of a pixel in geographical units</p></li>
<li><p>!pixel_height! (Mapnik &gt;= 2.1.0) -- height of a pixel in geographical units</p></li>
</ul>
</section>
</section>
<section id="usage-from-python">
<h2>Usage from Python<a class="headerlink" href="#usage-from-python" title="Link to this heading">¶</a></h2>
<p>Instantiate a datasource like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">lyr</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;Geometry from PostGIS&#39;</span><span class="p">)</span>
    <span class="n">lyr</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">PostGIS</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;your_postgis_database&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">=</span><span class="s1">&#39;your_table&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to do complex queries you can nest subselects in the <code class="docutils literal notranslate"><span class="pre">table</span></code> argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">lyr</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;Buffered Geometry from PostGIS&#39;</span><span class="p">)</span>
    <span class="n">BUFFERED_TABLE</span> <span class="o">=</span> <span class="s1">&#39;(select ST_Buffer(geometry, 5) as geometry from </span><span class="si">%s</span><span class="s1">) polygon&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;your_postgis_table&#39;</span><span class="p">)</span>
    <span class="n">lyr</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">PostGIS</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;your_postgis_database&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">=</span><span class="n">BUFFERED_TABLE</span><span class="p">)</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">add</span> <span class="n">something</span> <span class="n">after</span> <span class="n">the</span> <span class="n">query</span> <span class="p">(</span><span class="k">for</span> <span class="n">example</span> <span class="n">ORDER</span> <span class="n">BY</span><span class="p">)</span> <span class="n">you</span> <span class="n">must</span> <span class="n">use</span> <span class="err">!</span><span class="n">bbox</span><span class="err">!</span> <span class="n">dynamic</span> <span class="nb">map</span> <span class="n">variable</span><span class="p">:</span>

    <span class="n">lyr</span> <span class="o">=</span> <span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;Order by st_length from PostGIS&#39;</span><span class="p">)</span>
    <span class="n">BUFFERED_TABLE</span> <span class="o">=</span> <span class="s1">&#39;table_line where way &amp;&amp; !bbox! ORDER BY st_LENGTH(way) DESC&#39;</span>
    <span class="n">lyr</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">PostGIS</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;your_postgis_database&#39;</span><span class="p">,</span><span class="n">table</span><span class="o">=</span><span class="n">BUFFERED_TABLE</span><span class="p">,</span> <span class="n">srid</span><span class="o">=</span><span class="s1">&#39;your_srid&#39;</span><span class="p">,</span> <span class="n">geometry_field</span><span class="o">=</span><span class="s1">&#39;way&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="s1">&#39;your_extent&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><em>Note</em>: because mapnik depends on the <code class="docutils literal notranslate"><span class="pre">geometry_columns</span></code> entry be careful not to use sub-selects that change the geometry type.</p></li>
<li><p>Further references: See Artem's email on <a class="reference external" href="https://lists.berlios.de/pipermail/mapnik-users/2007-June/000300.html">using the PostGIS from Python</a></p></li>
<li><p>Example code at the Mapnik-utils project: <a class="reference external" href="http://mapnik-utils.googlecode.com/svn/example_code/postgis/postgis_geometry.py">http://mapnik-utils.googlecode.com/svn/example_code/postgis/postgis_geometry.py</a></p></li>
</ul>
</section>
<section id="usage-from-xml">
<h2>Usage from XML<a class="headerlink" href="#usage-from-xml" title="Link to this heading">¶</a></h2>
<p>If you are using XML mapfiles to style your data, then using a PostGIS datasource (with a sub-select in this case) looks like:</p>
<ul class="simple">
<li><p><em>Note</em>: if you use a sub-select that changes the extents of your features, make sure to use <code class="docutils literal notranslate"><span class="pre">estimate_extent=false</span></code> otherwise Mapnik will return no features. Otherwise you don't need to use the <code class="docutils literal notranslate"><span class="pre">estimate_extent</span></code> or <code class="docutils literal notranslate"><span class="pre">extent</span></code> parameters at all.</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">&lt;Layer</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;countries&quot;</span><span class="w"> </span><span class="na">status=</span><span class="s">&quot;on&quot;</span><span class="w"> </span><span class="na">srs=</span><span class="s">&quot;+proj=latlong +datum=WGS84&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;StyleName&gt;</span>countries_style_label<span class="nt">&lt;/StyleName&gt;</span>
<span class="w">        </span><span class="nt">&lt;Datasource&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;type&quot;</span><span class="nt">&gt;</span>postgis<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;host&quot;</span><span class="nt">&gt;</span>localhost<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dbname&quot;</span><span class="nt">&gt;</span>geodjango_geographic_admin<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user&quot;</span><span class="nt">&gt;</span>postgres<span class="nt">&lt;/Parameter&gt;</span><span class="w">      </span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;/Parameter&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;table&quot;</span><span class="nt">&gt;</span>(select<span class="w"> </span>ST_Buffer(ST_Centroid(geometry),2)<span class="w"> </span>as<span class="w"> </span>geometry,<span class="w"> </span>name<span class="w">  </span>from<span class="w"> </span>world_worldborders)<span class="w"> </span>as<span class="w"> </span>world<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;estimate_extent&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">          </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;extent&quot;</span><span class="nt">&gt;</span>-180,-90,180,89.99<span class="nt">&lt;/Parameter&gt;</span>
<span class="w">        </span><span class="nt">&lt;/Datasource&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Layer&gt;</span>
</pre></div>
</div>
<p><em>Note</em>: If you use a custom projection, you might need to change the extent parameters to the area for which the projection is defined. For example, the Dutch grid (EPSG:28992) is only defined around the Netherlands. It does not make sense to try to project South America onto it. You need to change the extent parameter to something like this:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">&lt;Parameter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;extent&quot;</span><span class="nt">&gt;</span>3.09582088671,50.6680811311,7.41350097346,53.6310799196<span class="nt">&lt;/Parameter&gt;</span>
</pre></div>
</div>
<p>If you don't do this, you might not see data from this data source at all, even if it does not contain data outside of the valid region. Also note that you always specify the extents in the coordinates of the source system.</p>
</section>
<section id="usage-from-c">
<h2>Usage from C++<a class="headerlink" href="#usage-from-c" title="Link to this heading">¶</a></h2>
<p>Plugin datasource initialization example code can be found on <a class="reference internal" href="PluginArchitecture.html"><span class="doc std std-doc">PluginArchitecture</span></a>.</p>
<p>A PostGIS datasource may be created as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mapnik/version.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mapnik/datasource_cache.hpp&gt;</span>

<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">parameters</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;postgis&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="s">&quot;host&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">database_hostname</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="s">&quot;port&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;5432&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="s">&quot;dbname&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;gis&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">your_username</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="s">&quot;password&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span>
<span class="w">        </span><span class="n">Layer</span><span class="w"> </span><span class="n">lyr</span><span class="p">(</span><span class="s">&quot;Roads&quot;</span><span class="p">);</span>
<span class="cp">#if MAPNIK_VERSION &gt;= 200200</span>
<span class="w">        </span><span class="n">set_datasource</span><span class="p">(</span><span class="n">datasource_cache</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">create</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="cp">#else</span>
<span class="w">        </span><span class="n">set_datasource</span><span class="p">(</span><span class="n">datasource_cache</span><span class="o">::</span><span class="n">instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">create</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="cp">#endif</span>
<span class="w">        </span><span class="n">lyr</span><span class="p">.</span><span class="n">add_style</span><span class="p">(</span><span class="s">&quot;roads&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">m</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">lyr</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<p>For other PostGIS parameters, see <a class="reference external" href="https://github.com/mapnik/mapnik/blob/master/plugins/input/postgis/postgis_datasource.cpp#L48">the postgis_datasource constructor in postgis_datasource.cpp#L48</a></p>
<p>TODO -- more PostGIS query usage</p>
</section>
<section id="further-references">
<h2>Further References<a class="headerlink" href="#further-references" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="http://wiki.openstreetmap.org/index.php/Mapnik/PostGIS">Using Mapnik and PostGIS with OSM</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, hellowac
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">PostGIS</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#advanced-usage">Advanced Usage</a><ul>
<li><a class="reference internal" href="#bbox-token">bbox token</a></li>
<li><a class="reference internal" href="#other-tokens">other tokens</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage-from-python">Usage from Python</a></li>
<li><a class="reference internal" href="#usage-from-xml">Usage from XML</a></li>
<li><a class="reference internal" href="#usage-from-c">Usage from C++</a></li>
<li><a class="reference internal" href="#further-references">Further References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=f115507d"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    </body>
</html>